# 开发日志记录 第一阶段 2020 年 7 月 7 日-8 月 10 日

## 2020 年 7 月 13 日

### 工作进展

-   杨宇华

    >

*   陈通

    > 解决了如何在index.js或其他页面中操作threejs渲染后的canvas中元素的问题，解决方法是使用getApp()来生成全局变量，通过将其作为参数传入model.js文件后使用

    > 更新了model.js，删除了不必要的部分并添加了注释

    > 实现了2D到3D视角的切换动画

*   袁巡

    > 完整实现了astar算法，并用加数据测试了导航的正确性

    > 开始蓝牙部分功能的书写，使用了半屏模态框，来提醒用户打开蓝牙，完成蓝牙接口的初始化

    > 开始书写，蓝牙的搜索部分，获取蓝牙的信息来进行操作

---

## 2020 年 7 月 10 日

### 工作进展

-   杨宇华

    > **2.12.0 版本正在灰度中**

    > 今天继续编写页面的上方组件，完成了搜索框、“起点终点模块”和“导航提示”的样式和排版，并完成了部分 JS 代码的接口

    > 添加了枫丹白露的 logo，将右侧组件进行了对齐

*   陈通

    > 今天主要在学习微信小程序的结构以及开发流程，下周可以正式开始代码编写

    > 学会了 git 分支冲突如何处理，解决了能够 push 但未显示在 contributors 中的问题

*   袁巡

    > 今天开始了小程序代码书写，完成了从服务获取数据，处理数据的部分

    > 开始了 astar 导航算法的编写，测试了多个 js 的传递参数问题

    > 发现多人协作进行开发，git 仓库会发生冲突，大家一起解决了冲突

---

## 2020 年 7 月 9 日

### 工作进展

-   杨宇华

    > 对整个页面进行布局设计，计算各模块的宽高比例，并设置了自适应宽高

    > 引入 weui 库，并测试成功，完成了前端两个模块的部分功能

    > 组件和 glb 模型存在冲突，**glb 模型所在的 canvas 会覆盖其他组件**，查询了大量的资料发现，微信小程序的 canvas 正在逐步支持同层渲染，**iOS 端已支持，Android 端预计 2.12.0 支持，当前版本 2.11.3**

*   陈通

    > 将 three.js 教程剩下的内容学习完毕

    > 测试了若干开源的微信地图小程序

    > 阅读源代码结构，理清函数调用关系，方便下一步重构代码

*   袁巡

    > 完成了所有源代码的阅读，并更新了思维导图，最新链接如下https://mubu.com/doc/61EcgRgg9qo#

    > 在 WebGL 中文网进行 threejs 的学习，可以加深对于源码的理解

---

## 2020 年 7 月 8 日

### 分工

-   杨宇华负责调试小程序，使其能在手机上正常运行；

-   陈通负责学习和使用 three.js， 使模型能够正常显示；

-   袁巡负责阅读原理，理清函数间的调用关系，方便以后的开发，
    ~~kbone 方案暂时废弃~~

### 工作进展

-   杨宇华

    > 小程序官方称 webGL 和 canva2D 都不能进行真机调试，而只能预览，报错还有可能是因为微信版本和小程序基础库的不支持，在小程序的后台可设置最低支持的版本库;

    > 模型成功在手机上预览，但是较大的模型似乎还不行，具体原因待查明；

    > 整理了文件结构，删除了暂时不需要的文件夹以及文件，方便后续开发。

-   陈通

    > 学习了 WebGL 中文网提供的 three.js 初级教程，对 three.js 的使用有了一个基本了解，包括但不限于基本形状的绘制、3D 模型的加载、物体的移动与旋转、光源和纹理的使用

    > 调整了测试 demo 的部分参数，使得模型能够正常显示，同时听取了刘成亮师兄的意见，通过分层加载的方式将整个楼层加载进小程序，今天尝试了双层并取得成功

-   袁巡

    > 再次阅读源码，完成了 map.js 和 blueLocation.js 的整理，并绘制出了思维导图，链接如下：
    > https://mubu.com/doc/61EcgRgg9qo

    > kbone 方案考虑到没有稳定的 web 版本，并且还要重构成 vue 等框架，所以暂时废弃

---

## 2020 年 7 月 7 日

1、暂时确定不使用云服务器

2、需要确定具体的方案:

-   杨宇华和陈通负责测试直接使用 three.js 在小程序上的可行性；

-   袁巡负责测试 kbone 等其他框架将原网页转换成小程序的可行性;

-   ~~企业号小程序的 web-view 可以直接显示网页，这个方案待定。~~

### 工作进展

-   杨宇华

    > 编写文档《室内定位项目中“不能自己实现蓝牙通讯或者获取蓝牙信息”的原因》

    > 安装小程序版的 three.js，初步测试小程序可以显示 glb 模型，但暂时无法在手机上正常显示，原因待查明

    > 经过调研，企业号小程序的 web-view 可以直接显示网页，但是无法调用蓝牙接口，该方案不可行

-   陈通

    > 测试了若干使用 three.js 的程序 demo，初步了解了如何在微信小程序上使用 three.js，但在进行真机调试时发现了若干问题，需要后面进一步解决

    > 对加载场景元素和 glb 文件的 loader 函数的参数进行了调整测试，初步了解了如何设置参数使模型处于合适的位置，后续需要进一步改进

    > 测试了一些使用 three.js 的微信小游戏，发现大多数是通过对普通 jpg、png 格式的图片使用物理引擎进行渲染，不符合我们的工程需要，另外了解到小游戏的审核较为严格，因此可行性不高

-   袁巡

    > 学习发现 kbone 框架特性和使用方法，发现还需将项目改变成 vue 等框架才能使用 kbone 进行部署

    > 在 kbone 框架 demo 当中测试微信小程序蓝牙接口，发现可行

    > 在 kbone 框架 demo 当中测试微信小程序 threejs 接口，发现可行，但依然存在在手机上无法显示 glb 模型的问题

---
